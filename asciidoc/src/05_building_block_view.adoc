ifndef::imagesdir[:imagesdir: ../images]

[[section-building-block-view]]
== Building Block View

Die Building Block View zeigt die statische Zerlegung des Systems in Bausteine sowie deren Abhängigkeiten.

=== Level 1: Whitebox Gesamtsystem (Backend)

Hier beschreiben wir die wichtigsten Teile des Systems und wie sie interagieren.

[plantuml, level1-overview, svg]
----
@startuml
component "Basket API" <<Subsystem>> as Basket
component "Quarry API" <<Subsystem>> as Quarry

Basket ..> Quarry : "nutzt (Validierung & Bestandsprüfung)"
@enduml
----

**Beschreibung der Subsysteme:**
* **Basket API:** Verwaltet den Einkaufskorb und die Logik für den Tauschprozess.
* **Quarry API:** Verwaltet die Hinkelsteine und den Zugriff auf den Steinbruch.

---

=== Level 2: Whitebox der APIs

In diesem Level zeigen wir die interne Struktur der APIs, unterteilt in logische Building Blocks (Module).

==== Basket API (Warenkorb)

Die Basket API verwaltet den Einkaufskorb. Man kann sehen, was drin ist, Sachen reinlegen, alles rauswerfen oder den Inhalt gegen einen Stein tauschen.

[plantuml, level2-basket, svg]
----
@startuml
package "Basket API" {
    [BasketController] as Controller
    [BasketService] as Service
    [BasketRepository] as Repo
}
Controller -> Service
Service -> Repo
@enduml
----

**Wichtige Schnittstellen (Interfaces):**
* `GET /api/basket`: Zeigt den Inhalt des Korbs.
* `GET /api/basket/offer`: Legt etwas in den Korb.
* `DELETE /api/basket`: Leert den Korb.
* `POST /api/basket/buy/{menhirId}`: Tauscht den Korb-Inhalt gegen den Stein mit der ID `menhirId`.

==== Quarry API (Steinbruch)

Die Quarry API verwaltet die Hinkelsteine.

[plantuml, level2-quarry, svg]
----
@startuml
package "Quarry API" {
    [QuarryController] as Controller
    [QuarryService] as Service
    [QuarryRepository] as Repo
}
Controller -> Service
Service -> Repo
@enduml
----

**Schnittstellen:**
* `GET /api/menhirs`: Zeigt alle Steine.
* `GET /api/menhirs/{menhirId}`: Zeigt einen bestimmten Stein.
* `POST /api/menhirs`: Erstellt einen neuen Stein.
* `PUT /api/menhirs/{menhirId}`: Ändert einen Stein.
* `DELETE /api/quarry/{menhirId}`: Löscht einen Stein.

---

=== Level 3: Whitebox Datenstrukturen

Hier werden die internen Bausteine (Klassen/DTOs) detailliert, die für den Datenaustausch genutzt werden.

[plantuml, level3-data, svg]
----
@startuml
class BasketDto {
    +List<BasketItem> items
}
class BasketItem {
    +String name
    +Integer amount
}
class MenhirDto {
    +Long menhirId
    +String name
}
BasketDto "1" *-- "*" BasketItem
@enduml
----

**Wichtige Datenobjekte:**
* **BasketDto:** Der Korb mit einer Liste von Sachen.
* **BasketItem:** Ein Gegenstand im Korb (Name und Anzahl).
* **MenhirDto:** Ein Hinkelstein.

---

== Frontend Architektur (Vue.js)

=== Level 1: Frontend Komponenten-Übersicht

Das Frontend ist eine Vue.js-Anwendung, die die Benutzeroberfläche für den Webshop bereitstellt. Die Komponenten folgen einer hierarchischen Struktur.

[plantuml, frontend-overview, svg]
----
@startuml
component "App.vue" <<RootComponent>> as App
component "UserView.vue" <<Container>> as UserView
component "AdminView.vue" <<Container>> as AdminView
component "Shop.vue" <<FeatureComponent>> as Shop
component "Card.vue" <<DisplayComponent>> as Card
component "BasketItem.vue" <<CartComponent>> as BasketItem

App --> UserView
App --> AdminView
UserView --> Shop
UserView --> BasketItem
Shop --> Card
Card --> Shop : "Produkt zum Korb hinzufügen"
@enduml
----

**Beschreibung der Komponenten:**
* **App.vue:** Root-Komponente mit Router und Korb-Sidebar. Verwaltet die Navigation zwischen Benutzer- und Admin-Bereich.
* **UserView.vue:** Container für die Benutzer-Shopping-Seite. Verbindet Shop und Warenkorb.
* **AdminView.vue:** Container für die Admin-Verwaltungsfunktionen.
* **Shop.vue:** Zeigt alle Produkte in einem Grid an und sendet ausgewählte Produkte in den Warenkorb.
* **Card.vue:** Einzelne Produktkarte mit Bild, Titel und "In den Korb"-Button.
* **BasketItem.vue:** Warenkorbposition in der Sidebar mit Menge erhöhen/verringern Funktionen.

=== Level 2: Komponenten-Interaktionen

==== Benutzer-Shopping-Flow

[plantuml, shopping-flow, svg]
----
@startuml
actor User
participant Shop
participant Card
participant "cart.js\n(Store)" as Store
participant "BasketItem"

User -> Card: Klick "In den Korb"
Card -> Shop: emitAddToCart(product)
Shop -> Store: Produkt hinzufügen
Store -> BasketItem: Update
BasketItem -> User: Anzeige Menge + Preis
@enduml
----

**Ablauf:**
1. Benutzer wählt ein Produkt aus der **Shop.vue** Produktliste.
2. **Card.vue** zeigt die Produktdetails und hat einen "In den Korb"-Button.
3. Klick auf den Button sendet das Produkt an den Warenkorb (State Management via Pinia Store).
4. **BasketItem.vue** zeigt den Warenkorbeintrag mit Funktionen zum Erhöhen/Verringern der Menge.
5. Der Warenkorb wird in der **App.vue** Sidebar aktualisiert.

==== Admin-Verwaltung

Die **AdminView.vue** bietet Admin-Funktionen für die Verwaltung des Inventars über die Backend-APIs.